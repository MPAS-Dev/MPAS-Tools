<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coastline Alteration &mdash; mpas_tools 0.22.0rc1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Meridional Overturning Circulation" href="moc.html" />
    <link rel="prev" title="Coastal Tools" href="coastal_tools.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            mpas_tools
          </a>
              <div class="version">
                0.22.0rc1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mesh_creation.html">Mesh Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mesh_conversion.html">Mesh Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interpolation.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cime.html">CIME Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Config files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transects.html">Transects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization.html">Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ocean Tools</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mesh_creation.html">Ocean Mesh Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="coastal_tools.html">Coastal Tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Coastline Alteration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adding-land-blockages">Adding Land Blockages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#masking-land-locked-cells">Masking Land-locked Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="#widening-transects">Widening Transects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="moc.html">Meridional Overturning Circulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="depth.html">Adding a Depth Coordinate</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sea-ice Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../seaice/mask.html">Mask</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seaice/mesh.html">Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seaice/partition.html">Graph partitioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seaice/regions.html">Region masks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seaice/regrid.html">Regrid</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../making_changes.html">Making Changes to mpas_tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing_changes.html">Testing Changes to mpas_tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Authors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Main Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html#contributors">Contributors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">mpas_tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Coastline Alteration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ocean/coastline_alteration.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="coastline-alteration">
<span id="ocean-coastline-alteration"></span><h1>Coastline Alteration<a class="headerlink" href="#coastline-alteration" title="Permalink to this heading">¶</a></h1>
<p>The <a class="reference internal" href="../generated/mpas_tools.ocean.coastline_alteration.html#module-mpas_tools.ocean.coastline_alteration" title="mpas_tools.ocean.coastline_alteration"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mpas_tools.ocean.coastline_alteration</span></code></a> module contains several
functions for modifying the coastline in MPAS cells.  This is accomplished by
modifying the land mask that indicates which MPAS cells are ocean vs. land
(or grounded ice).</p>
<section id="adding-land-blockages">
<span id="coastline-land-blockages"></span><h2>Adding Land Blockages<a class="headerlink" href="#adding-land-blockages" title="Permalink to this heading">¶</a></h2>
<p>The function
<a class="reference internal" href="../generated/mpas_tools.ocean.coastline_alteration.add_critical_land_blockages.html#mpas_tools.ocean.coastline_alteration.add_critical_land_blockages" title="mpas_tools.ocean.coastline_alteration.add_critical_land_blockages"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.ocean.coastline_alteration.add_critical_land_blockages()</span></code></a>
add the masks associated with one or more transects to the land mask.  This is
useful if there are land features (typically peninsulas or narrow land bridges)
that must block the ocean flow even if they are too narrow to be resolved in
the MPAS mesh.</p>
<p>An example of the typical workflow that uses this function would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span>

<span class="kn">from</span> <span class="nn">geometric_features</span> <span class="kn">import</span> <span class="n">GeometricFeatures</span>
<span class="kn">from</span> <span class="nn">mpas_tools.mesh</span> <span class="kn">import</span> <span class="n">conversion</span>
<span class="kn">from</span> <span class="nn">mpas_tools.ocean.coastline_alteration</span> <span class="kn">import</span> <span class="n">add_critical_land_blockages</span>


<span class="c1"># an object used to read feature collections from the geometric_features</span>
<span class="c1"># package</span>
<span class="n">gf</span> <span class="o">=</span> <span class="n">GeometricFeatures</span><span class="p">()</span>

<span class="c1"># get geometry of the land coverage from Natural Earth</span>
<span class="n">fcLandCoverage</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">componentName</span><span class="o">=</span><span class="s1">&#39;natural_earth&#39;</span><span class="p">,</span> <span class="n">objectType</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span>
                         <span class="n">featureNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Land Coverage&#39;</span><span class="p">])</span>

<span class="c1"># read in the base mesh</span>
<span class="n">dsBaseMesh</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;base_mesh.nc&#39;</span><span class="p">)</span>
<span class="c1"># create a mask on the base mesh that is ones for land or grounded ice and</span>
<span class="c1"># zeros for ocean</span>
<span class="n">dsLandMask</span> <span class="o">=</span> <span class="n">conversion</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">dsBaseMesh</span><span class="p">,</span> <span class="n">fcMask</span><span class="o">=</span><span class="n">fcLandCoverage</span><span class="p">)</span>

<span class="c1"># get a collection of features from geometric_features that are meant for</span>
<span class="c1"># use as critical land blockages</span>
<span class="n">fcCritBlockages</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">componentName</span><span class="o">=</span><span class="s1">&#39;ocean&#39;</span><span class="p">,</span> <span class="n">objectType</span><span class="o">=</span><span class="s1">&#39;transect&#39;</span><span class="p">,</span>
                          <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Critical_Land_Blockage&#39;</span><span class="p">])</span>

<span class="c1"># make masks from the transects</span>
<span class="n">dsCritBlockMask</span> <span class="o">=</span> <span class="n">conversion</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">dsBaseMesh</span><span class="p">,</span> <span class="n">fcMask</span><span class="o">=</span><span class="n">fcCritBlockages</span><span class="p">)</span>

<span class="c1"># add the masks to the &quot;land&quot; mask</span>
<span class="n">dsLandMask</span> <span class="o">=</span> <span class="n">add_critical_land_blockages</span><span class="p">(</span><span class="n">dsLandMask</span><span class="p">,</span> <span class="n">dsCritBlockMask</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="masking-land-locked-cells">
<span id="coastline-mask-land-locked"></span><h2>Masking Land-locked Cells<a class="headerlink" href="#masking-land-locked-cells" title="Permalink to this heading">¶</a></h2>
<p>By default, the land mask produced by the MPAS <a class="reference internal" href="../mesh_conversion.html#mask-creator"><span class="std std-ref">Mask Creator</span></a> can produce
ocean cells with vertices that are all on the land-ocean boundary.  MPAS-Seaice
uses a so-called
<a class="reference external" href="https://doi.org/10.1016%2FB978-0-12-460817-7.50009-4">Arakawa B-grid</a>,
meaning that velocities are located at vertices of the MPAS mesh.  This means
that sea-ice flow into or out of a given cell is not possible if all vertices
of that cell are boundary vertices (where the velocity is, by definition, zero).
This problem is alleviated by calling
<a class="reference internal" href="../generated/mpas_tools.ocean.coastline_alteration.add_land_locked_cells_to_mask.html#mpas_tools.ocean.coastline_alteration.add_land_locked_cells_to_mask" title="mpas_tools.ocean.coastline_alteration.add_land_locked_cells_to_mask"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.ocean.coastline_alteration.add_land_locked_cells_to_mask()</span></code></a>.
Any “land-locked” cells with only boundary vertices are removed from the mesh.
Land-locked cells are only removed poleward of a threshold latitude (43 degrees
by default).  The user can specify the number of iterations (<code class="docutils literal notranslate"><span class="pre">nSweeps</span></code>) of
land-locked cell removal, since removing land-locked cells can produce new
land-locked cells.</p>
<p>Here is an example workflow that removes land-locked cells:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span>

<span class="kn">from</span> <span class="nn">geometric_features</span> <span class="kn">import</span> <span class="n">GeometricFeatures</span>
<span class="kn">from</span> <span class="nn">mpas_tools.mesh</span> <span class="kn">import</span> <span class="n">conversion</span>
<span class="kn">from</span> <span class="nn">mpas_tools.ocean.coastline_alteration</span> <span class="kn">import</span> \
    <span class="n">add_land_locked_cells_to_mask</span>


<span class="c1"># an object used to read feature collections from the geometric_features</span>
<span class="c1"># package</span>
<span class="n">gf</span> <span class="o">=</span> <span class="n">GeometricFeatures</span><span class="p">()</span>

<span class="c1"># get geometry of the land coverage from Natural Earth</span>
<span class="n">fcLandCoverage</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">componentName</span><span class="o">=</span><span class="s1">&#39;natural_earth&#39;</span><span class="p">,</span> <span class="n">objectType</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span>
                         <span class="n">featureNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Land Coverage&#39;</span><span class="p">])</span>

<span class="c1"># read in the base mesh</span>
<span class="n">dsBaseMesh</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;base_mesh.nc&#39;</span><span class="p">)</span>
<span class="c1"># create a mask on the base mesh that is ones for land or grounded ice and</span>
<span class="c1"># zeros for ocean</span>
<span class="n">dsLandMask</span> <span class="o">=</span> <span class="n">conversion</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">dsBaseMesh</span><span class="p">,</span> <span class="n">fcMask</span><span class="o">=</span><span class="n">fcLandCoverage</span><span class="p">)</span>

<span class="c1"># Find ocean cells that are land-locked, and alter the cell mask so that</span>
<span class="c1"># they are counted as land cells</span>
<span class="n">dsLandMask</span> <span class="o">=</span> <span class="n">add_land_locked_cells_to_mask</span><span class="p">(</span><span class="n">dsLandMask</span><span class="p">,</span> <span class="n">dsBaseMesh</span><span class="p">,</span>
                                           <span class="n">latitude_threshold</span><span class="o">=</span><span class="mf">43.0</span><span class="p">,</span>
                                           <span class="n">nSweeps</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="widening-transects">
<span id="coastline-widen-transects"></span><h2>Widening Transects<a class="headerlink" href="#widening-transects" title="Permalink to this heading">¶</a></h2>
<p>Similarly to <a class="reference internal" href="#coastline-mask-land-locked"><span class="std std-ref">Masking Land-locked Cells</span></a>, if critical passages in polar
regions are too narrow, they can become blocked by sea ice that cannot be
advected.  Sea-ice flow is not possible unless channels are at least 2 cells
wide. This widening is accomplished with
<a class="reference internal" href="../generated/mpas_tools.ocean.coastline_alteration.widen_transect_edge_masks.html#mpas_tools.ocean.coastline_alteration.widen_transect_edge_masks" title="mpas_tools.ocean.coastline_alteration.widen_transect_edge_masks"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.ocean.coastline_alteration.widen_transect_edge_masks()</span></code></a>.
Channels are only widened poleward of a threshold latitude (43 degrees by
default).</p>
<p>An example workflow that includes transect-widening is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span>

<span class="kn">from</span> <span class="nn">geometric_features</span> <span class="kn">import</span> <span class="n">GeometricFeatures</span>
<span class="kn">from</span> <span class="nn">mpas_tools.mesh</span> <span class="kn">import</span> <span class="n">conversion</span>
<span class="kn">from</span> <span class="nn">mpas_tools.ocean.coastline_alteration</span> <span class="kn">import</span> <span class="n">widen_transect_edge_masks</span>

<span class="c1"># an object used to read feature collections from the geometric_features</span>
<span class="c1"># package</span>
<span class="n">gf</span> <span class="o">=</span> <span class="n">GeometricFeatures</span><span class="p">()</span>

<span class="c1"># read in the base mesh</span>
<span class="n">dsBaseMesh</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;base_mesh.nc&#39;</span><span class="p">)</span>

<span class="c1"># merge transects for critical passages into critical_passages.geojson</span>
<span class="n">fcCritPassages</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">componentName</span><span class="o">=</span><span class="s1">&#39;ocean&#39;</span><span class="p">,</span> <span class="n">objectType</span><span class="o">=</span><span class="s1">&#39;transect&#39;</span><span class="p">,</span>
                         <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Critical_Passage&#39;</span><span class="p">])</span>

<span class="c1"># create masks from the transects</span>
<span class="n">dsCritPassMask</span> <span class="o">=</span> <span class="n">conversion</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">dsBaseMesh</span><span class="p">,</span> <span class="n">fcMask</span><span class="o">=</span><span class="n">fcCritPassages</span><span class="p">)</span>

<span class="c1"># Alter critical passages to be at least two cells wide, to avoid sea ice</span>
<span class="c1"># blockage.</span>
<span class="n">dsCritPassMask</span> <span class="o">=</span> <span class="n">widen_transect_edge_masks</span><span class="p">(</span><span class="n">dsCritPassMask</span><span class="p">,</span> <span class="n">dsBaseMesh</span><span class="p">,</span>
                                           <span class="n">latitude_threshold</span><span class="o">=</span><span class="mf">43.0</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="coastal_tools.html" class="btn btn-neutral float-left" title="Coastal Tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="moc.html" class="btn btn-neutral float-right" title="Meridional Overturning Circulation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright This software is open source software available under the BSD-3license. Copyright (c) 2019 Triad National Security, LLC. All rights reserved. Copyright (c) 2019 Lawrence Livermore National Security, LLC. All rights reserved. Copyright (c) 2019 UT-Battelle, LLC. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>