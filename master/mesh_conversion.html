

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mesh Conversion &mdash; mpas_tools master documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=30d551ce"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interpolation" href="interpolation.html" />
    <link rel="prev" title="Mesh Creation" href="mesh_creation.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            mpas_tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh_creation.html">Mesh Creation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Mesh Conversion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mesh-converter">Mesh Converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cell-culler">Cell Culler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mask-creator">Mask Creator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mask-creation-with-python-multiprocessing">Mask Creation with Python Multiprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#key-functions">Key Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-usage">General Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-creating-region-masks-on-an-mpas-mesh">Example: Creating Region Masks on an MPAS Mesh</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#arguments-and-options">Arguments and Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-note">Performance Note</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extensibility-and-limitations">Extensibility and Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computing-transect-masks">Computing Transect Masks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computing-a-flood-fill-mask">Computing a Flood-fill Mask</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computing-lon-lat-region-masks">Computing Lon/Lat Region Masks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#culling-mpas-datasets">Culling MPAS Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#merging-and-splitting">Merging and Splitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#translation">Translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#converting-between-mesh-formats">Converting Between Mesh Formats</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#msh-to-mpas-netcdf">MSH to MPAS NetCDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#triangle-to-mpas-netcdf">Triangle to MPAS NetCDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mpas-netcdf-to-triangle">MPAS NetCDF to Triangle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mpas-netcdf-to-scrip">MPAS NetCDF to SCRIP</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interpolation.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cime.html">CIME Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Config files</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">I/O Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="transects.html">Transects</a></li>
<li class="toctree-l1"><a class="reference internal" href="vector.html">Vector Operations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Visualization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpas_to_xdmf.html">MPAS to XDMF Converter</a></li>
<li class="toctree-l1"><a class="reference internal" href="paraview_extractor.html">ParaView VTK Extractor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Landice Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="landice/visualization.html">Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ocean Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ocean/mesh_creation.html">Ocean Mesh Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/coastal_tools.html">Coastal Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/coastline_alteration.html">Coastline Alteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/moc.html">Meridional Overturning Circulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/depth.html">Adding a Depth Coordinate</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/streamfunction.html">Computing streamfunctions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/visualization.html">Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sea-ice Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="seaice/mask.html">Mask</a></li>
<li class="toctree-l1"><a class="reference internal" href="seaice/mesh.html">Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="seaice/partition.html">Graph partitioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="seaice/regions.html">Region masks</a></li>
<li class="toctree-l1"><a class="reference internal" href="seaice/regrid.html">Regrid</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="making_changes.html">Making Changes to mpas_tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing_changes.html">Testing Changes to mpas_tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_docs.html#previewing-the-documentation">Previewing the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasing.html">Releasing a New Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Authors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Main Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html#contributors">Contributors</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mpas_tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Mesh Conversion</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mesh_conversion.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mesh-conversion">
<span id="id1"></span><h1>Mesh Conversion<a class="headerlink" href="#mesh-conversion" title="Link to this heading">ÔÉÅ</a></h1>
<section id="mesh-converter">
<span id="id2"></span><h2>Mesh Converter<a class="headerlink" href="#mesh-converter" title="Link to this heading">ÔÉÅ</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">MpasMeshConverter.x</span></code> command-line tool and the Python wrapper
<a class="reference internal" href="generated/mpas_tools.mesh.conversion.convert.html#mpas_tools.mesh.conversion.convert" title="mpas_tools.mesh.conversion.convert"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.conversion.convert()</span></code></a> convert a dataset describing
cell and vertex locations and connectivity into a valid MPAS mesh that
follows the <a class="reference external" href="https://mpas-dev.github.io/files/documents/MPAS-MeshSpec.pdf">MPAS mesh specification</a>.</p>
<p>Example usage (command line):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ planar_hex --nx 4 --ny 4 --dc 10e3 -o base_mesh.nc
$ MpasMeshConverter.x base_mesh.nc mesh.nc
</pre></div>
</div>
<p>This generates a small, doubly periodic MPAS mesh and converts it to a
spec-compliant format. <code class="docutils literal notranslate"><span class="pre">MpasMeshConverter.x</span></code> takes input and output mesh
filenames as arguments; if omitted, it prompts for them.</p>
<p>Equivalent Python usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.planar_hex</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_planar_hex_mesh</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.mesh.conversion</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_netcdf</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">make_planar_hex_mesh</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="mf">10e3</span><span class="p">,</span> <span class="n">nonperiodic_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">nonperiodic_y</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="n">write_netcdf</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s1">&#39;mesh.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Input requirements:</strong> The mesh must define the following dimensions,
variables, and global attributes (example sizes shown):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">netcdf</span> <span class="n">mesh</span> <span class="p">{</span>
<span class="n">dimensions</span><span class="p">:</span>
  <span class="n">nCells</span> <span class="o">=</span> <span class="mi">16</span> <span class="p">;</span>
  <span class="n">nVertices</span> <span class="o">=</span> <span class="mi">32</span> <span class="p">;</span>
  <span class="n">vertexDegree</span> <span class="o">=</span> <span class="mi">3</span> <span class="p">;</span>
<span class="n">variables</span><span class="p">:</span>
  <span class="n">double</span> <span class="n">xCell</span><span class="p">(</span><span class="n">nCells</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">double</span> <span class="n">yCell</span><span class="p">(</span><span class="n">nCells</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">double</span> <span class="n">zCell</span><span class="p">(</span><span class="n">nCells</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">double</span> <span class="n">xVertex</span><span class="p">(</span><span class="n">nVertices</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">double</span> <span class="n">yVertex</span><span class="p">(</span><span class="n">nVertices</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">double</span> <span class="n">zVertex</span><span class="p">(</span><span class="n">nVertices</span><span class="p">)</span> <span class="p">;</span>
  <span class="nb">int</span> <span class="n">cellsOnVertex</span><span class="p">(</span><span class="n">nVertices</span><span class="p">,</span> <span class="n">vertexDegree</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">double</span> <span class="n">meshDensity</span><span class="p">(</span><span class="n">nCells</span><span class="p">)</span> <span class="p">;</span>

<span class="o">//</span> <span class="k">global</span> <span class="n">attributes</span><span class="p">:</span>
      <span class="p">:</span><span class="n">on_a_sphere</span> <span class="o">=</span> <span class="s2">&quot;NO&quot;</span> <span class="p">;</span>
      <span class="p">:</span><span class="n">sphere_radius</span> <span class="o">=</span> <span class="mf">0.</span> <span class="p">;</span>
      <span class="p">:</span><span class="n">is_periodic</span> <span class="o">=</span> <span class="s2">&quot;YES&quot;</span> <span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">meshDensity</span></code> variable is required for historical reasons and is passed
unchanged to the output mesh.</p>
<p>Optional global attributes (passed through):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="k">global</span> <span class="n">attributes</span><span class="p">:</span>
      <span class="p">:</span><span class="n">x_period</span> <span class="o">=</span> <span class="mf">40000.</span> <span class="p">;</span>
      <span class="p">:</span><span class="n">y_period</span> <span class="o">=</span> <span class="mf">34641.0161513775</span> <span class="p">;</span>
      <span class="p">:</span><span class="n">history</span> <span class="o">=</span> <span class="s2">&quot;Tue May 26 20:58:10 2020: /home/xylar/miniconda3/envs/mpas/bin/planar_hex --nx 4 --ny 4 --dc 10e3 -o base_mesh.nc&quot;</span> <span class="p">;</span>
</pre></div>
</div>
<p>If present, the <code class="docutils literal notranslate"><span class="pre">file_id</span></code> attribute is preserved as <code class="docutils literal notranslate"><span class="pre">parent_id</span></code> in the
output mesh, and a new <code class="docutils literal notranslate"><span class="pre">file_id</span></code> is generated.</p>
<p>The converter also generates a <code class="docutils literal notranslate"><span class="pre">graph.info</span></code> file for graph partitioning
tools (e.g., Metis). In Python, this file is only written if the
<code class="docutils literal notranslate"><span class="pre">graphInfoFileName</span></code> argument is provided.</p>
</section>
<section id="cell-culler">
<span id="id3"></span><h2>Cell Culler<a class="headerlink" href="#cell-culler" title="Link to this heading">ÔÉÅ</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">MpasCellCuller.x</span></code> command-line tool and the Python wrapper
<a class="reference internal" href="generated/mpas_tools.mesh.conversion.cull.html#mpas_tools.mesh.conversion.cull" title="mpas_tools.mesh.conversion.cull"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.conversion.cull()</span></code></a> remove cells from a mesh based on
the <code class="docutils literal notranslate"><span class="pre">cullCell</span></code> field and/or provided mask datasets. The culling logic is:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">cullCell</span></code> field, mask(s) from a masking dataset, and the inverse of
mask(s) from an inverse-masking dataset are merged (union).</p></li>
<li><p>A preserve-masking dataset indicates cells that must <em>not</em> be culled.</p></li>
</ul>
<p>Example workflow (command line):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ merge_features -c natural_earth -b region -n &quot;Land Coverage&quot; -o land.geojson
$ MpasMaskCreator.x base_mesh.nc land.nc -f land.geojson
$ MpasCellCuller.x base_mesh.nc culled_mesh.nc -m land.nc
</pre></div>
</div>
<p>This merges features to create a land mask, generates a mask on the mesh,
and culls cells where the mask is 1.</p>
<p>Equivalent Python workflow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">geometric_features</span><span class="w"> </span><span class="kn">import</span> <span class="n">GeometricFeatures</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.mesh.conversion</span><span class="w"> </span><span class="kn">import</span> <span class="n">mask</span><span class="p">,</span> <span class="n">cull</span>

<span class="n">gf</span> <span class="o">=</span> <span class="n">GeometricFeatures</span><span class="p">()</span>
<span class="n">fcLandCoverage</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="n">componentName</span><span class="o">=</span><span class="s1">&#39;natural_earth&#39;</span><span class="p">,</span>
    <span class="n">objectType</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span>
    <span class="n">featureNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Land Coverage&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">dsBaseMesh</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;base_mesh.nc&#39;</span><span class="p">)</span>
<span class="n">dsLandMask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">dsBaseMesh</span><span class="p">,</span> <span class="n">fcMask</span><span class="o">=</span><span class="n">fcLandCoverage</span><span class="p">)</span>
<span class="n">dsCulledMesh</span> <span class="o">=</span> <span class="n">cull</span><span class="p">(</span><span class="n">dsBaseMesh</span><span class="p">,</span> <span class="n">dsMask</span><span class="o">=</span><span class="n">dsLandMask</span><span class="p">)</span>
<span class="n">write_netcdf</span><span class="p">(</span><span class="n">dsCulledMesh</span><span class="p">,</span> <span class="s1">&#39;culled_mesh.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Full usage of <code class="docutils literal notranslate"><span class="pre">MpasCellCuller.x</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MpasCellCuller</span><span class="o">.</span><span class="n">x</span> <span class="p">[</span><span class="n">input_name</span><span class="p">]</span> <span class="p">[</span><span class="n">output_name</span><span class="p">]</span> <span class="p">[[</span><span class="o">-</span><span class="n">m</span><span class="o">/-</span><span class="n">i</span><span class="o">/-</span><span class="n">p</span><span class="p">]</span> <span class="n">masks_name</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="p">]</span>

    <span class="n">input_name</span><span class="p">:</span>         <span class="n">Input</span> <span class="n">MPAS</span> <span class="n">mesh</span><span class="o">.</span>
    <span class="n">output_name</span><span class="p">:</span>        <span class="n">Output</span> <span class="n">culled</span> <span class="n">MPAS</span> <span class="n">mesh</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">culled_mesh</span><span class="o">.</span><span class="n">nc</span><span class="p">)</span><span class="o">.</span>
    <span class="o">-</span><span class="n">m</span><span class="o">/-</span><span class="n">i</span><span class="o">/-</span><span class="n">p</span><span class="p">:</span>           <span class="n">Masking</span> <span class="n">options</span><span class="p">:</span>
        <span class="o">-</span><span class="n">m</span><span class="p">:</span> <span class="n">Mask</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="o">=</span> <span class="n">cull</span> <span class="n">cell</span><span class="p">)</span><span class="o">.</span>
        <span class="o">-</span><span class="n">i</span><span class="p">:</span> <span class="n">Inverse</span> <span class="n">mask</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="o">=</span> <span class="n">cull</span> <span class="n">cell</span><span class="p">)</span><span class="o">.</span>
        <span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="n">Preserve</span> <span class="n">mask</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="o">=</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">cull</span> <span class="n">cell</span><span class="p">)</span><span class="o">.</span>
    <span class="o">-</span><span class="n">c</span><span class="p">:</span>                 <span class="n">Output</span> <span class="n">cell</span> <span class="n">mapping</span> <span class="n">files</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="mask-creator">
<span id="id4"></span><h2>Mask Creator<a class="headerlink" href="#mask-creator" title="Link to this heading">ÔÉÅ</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">MpasMaskCreator.x</span></code> command-line tool and the Python wrapper
<a class="reference internal" href="generated/mpas_tools.mesh.conversion.mask.html#mpas_tools.mesh.conversion.mask" title="mpas_tools.mesh.conversion.mask"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.conversion.mask()</span></code></a> create region masks from features
or seed points.</p>
<p>Example usage is shown above under Cell Culler.</p>
<p>Full usage of <code class="docutils literal notranslate"><span class="pre">MpasMaskCreator.x</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MpasMaskCreator</span><span class="o">.</span><span class="n">x</span> <span class="n">in_file</span> <span class="n">out_file</span> <span class="p">[</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="o">/-</span><span class="n">s</span><span class="p">]</span> <span class="n">file</span><span class="o">.</span><span class="n">geojson</span> <span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">positive_lon</span><span class="p">]</span>
    <span class="n">in_file</span><span class="p">:</span> <span class="n">Input</span> <span class="n">mesh</span> <span class="n">file</span><span class="o">.</span>
    <span class="n">out_file</span><span class="p">:</span> <span class="n">Output</span> <span class="n">mask</span> <span class="n">file</span><span class="o">.</span>
    <span class="o">-</span><span class="n">s</span> <span class="n">file</span><span class="o">.</span><span class="n">geojson</span><span class="p">:</span> <span class="n">Use</span> <span class="n">points</span> <span class="k">as</span> <span class="n">seed</span> <span class="n">locations</span> <span class="k">for</span> <span class="n">flood</span> <span class="n">fill</span><span class="o">.</span>
    <span class="o">-</span><span class="n">f</span> <span class="n">file</span><span class="o">.</span><span class="n">geojson</span><span class="p">:</span> <span class="n">Use</span> <span class="n">features</span> <span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">transects</span><span class="p">,</span> <span class="ow">or</span> <span class="n">points</span><span class="p">)</span> <span class="k">for</span> <span class="n">masks</span><span class="o">.</span>
    <span class="o">--</span><span class="n">positive_lon</span><span class="p">:</span> <span class="n">Use</span> <span class="mi">0</span><span class="o">-</span><span class="mi">360</span> <span class="n">longitude</span> <span class="nb">range</span> <span class="k">for</span> <span class="n">non</span><span class="o">-</span><span class="n">standard</span> <span class="n">geojson</span> <span class="n">files</span><span class="o">.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Temporary files are created and deleted automatically by the Python wrappers.
Command-line tools require the relevant executables to be available in the path.</p>
</div>
</section>
<section id="mask-creation-with-python-multiprocessing">
<span id="py-mask-creation"></span><h2>Mask Creation with Python Multiprocessing<a class="headerlink" href="#mask-creation-with-python-multiprocessing" title="Link to this heading">ÔÉÅ</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">mpas_tools.mesh.mask</span></code> module provides a set of Python functions for
creating region and transect masks on MPAS meshes and longitude/latitude grids.
These functions are designed to be more efficient and flexible than the legacy
serial C++ Mask Creator, especially when used with Python‚Äôs multiprocessing.</p>
<section id="key-functions">
<h3>Key Functions<a class="headerlink" href="#key-functions" title="Link to this heading">ÔÉÅ</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>compute_mpas_region_masks</p></td>
<td><p>Create region masks (polygons) on MPAS meshes</p></td>
</tr>
<tr class="row-odd"><td><p>compute_mpas_transect_masks</p></td>
<td><p>Create transect masks (lines) on MPAS meshes</p></td>
</tr>
<tr class="row-even"><td><p>compute_mpas_flood_fill_mask</p></td>
<td><p>Create a mask by flood-filling from seed points</p></td>
</tr>
<tr class="row-odd"><td><p>compute_lon_lat_region_masks</p></td>
<td><p>Create region masks on a 2D lon/lat grid</p></td>
</tr>
<tr class="row-even"><td><p>compute_projection_grid_region_masks</p></td>
<td><p>Create region masks on a projected (e.g., polar) grid</p></td>
</tr>
</tbody>
</table>
<p>All of these functions accept a <code class="docutils literal notranslate"><span class="pre">pool</span></code> argument (a <code class="docutils literal notranslate"><span class="pre">multiprocessing.Pool</span></code>)
to parallelize the computation, which is highly recommended for large meshes or
grids. If <code class="docutils literal notranslate"><span class="pre">pool=None</span></code>, the computation will be performed serially, which may
be slow for large datasets.</p>
</section>
<section id="general-usage">
<h3>General Usage<a class="headerlink" href="#general-usage" title="Link to this heading">ÔÉÅ</a></h3>
<p>The typical workflow is:</p>
<ol class="arabic simple">
<li><p>Open your MPAS mesh or grid as an <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code>.</p></li>
<li><p>Read a <code class="docutils literal notranslate"><span class="pre">geometric_features.FeatureCollection</span></code> (e.g., from a GeoJSON file).</p></li>
<li><p>Optionally, create a multiprocessing pool using
<a class="reference internal" href="generated/mpas_tools.parallel.create_pool.html#mpas_tools.parallel.create_pool" title="mpas_tools.parallel.create_pool"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.parallel.create_pool()</span></code></a>.</p></li>
<li><p>Call the appropriate mask creation function, passing the mesh/grid, feature
collection, and pool.</p></li>
<li><p>Write the resulting masks to a NetCDF file using
<a class="reference internal" href="generated/mpas_tools.io.write_netcdf.html#mpas_tools.io.write_netcdf" title="mpas_tools.io.write_netcdf"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.io.write_netcdf()</span></code></a>.</p></li>
</ol>
<section id="example-creating-region-masks-on-an-mpas-mesh">
<h4>Example: Creating Region Masks on an MPAS Mesh<a class="headerlink" href="#example-creating-region-masks-on-an-mpas-mesh" title="Link to this heading">ÔÉÅ</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">geometric_features</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_feature_collection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.mesh.mask</span><span class="w"> </span><span class="kn">import</span> <span class="n">compute_mpas_region_masks</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.parallel</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_pool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_netcdf</span>

<span class="n">dsMesh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;mesh.nc&#39;</span><span class="p">,</span> <span class="n">decode_cf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fcMask</span> <span class="o">=</span> <span class="n">read_feature_collection</span><span class="p">(</span><span class="s1">&#39;regions.geojson&#39;</span><span class="p">)</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">create_pool</span><span class="p">(</span><span class="n">process_count</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">dsMasks</span> <span class="o">=</span> <span class="n">compute_mpas_region_masks</span><span class="p">(</span>
    <span class="n">dsMesh</span><span class="p">,</span> <span class="n">fcMask</span><span class="p">,</span> <span class="n">maskTypes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="s1">&#39;vertex&#39;</span><span class="p">),</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span>
<span class="p">)</span>
<span class="n">write_netcdf</span><span class="p">(</span><span class="n">dsMasks</span><span class="p">,</span> <span class="s1">&#39;region_masks.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="arguments-and-options">
<h3>Arguments and Options<a class="headerlink" href="#arguments-and-options" title="Link to this heading">ÔÉÅ</a></h3>
<p>All mask creation functions share several common arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">logger</span></code>: Optional logger for progress output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pool</span></code>: Optional multiprocessing pool for parallel computation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chunkSize</span></code>: Number of points to process per chunk (default: 1000).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">showProgress</span></code>: Whether to display a progress bar.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subdivisionThreshold</span></code> or <code class="docutils literal notranslate"><span class="pre">subdivisionResolution</span></code>: Controls subdivision
of large polygons or transects for efficiency.</p></li>
</ul>
<p>Refer to the Python docstrings or the command-line <code class="docutils literal notranslate"><span class="pre">--help</span></code> output for
details on each function‚Äôs arguments.</p>
</section>
<section id="performance-note">
<h3>Performance Note<a class="headerlink" href="#performance-note" title="Link to this heading">ÔÉÅ</a></h3>
<p>For large meshes or grids, using a multiprocessing pool (via the <code class="docutils literal notranslate"><span class="pre">pool</span></code>
argument) is strongly recommended for reasonable performance. The pool should
be created early in your script, before large objects are loaded into memory,
and terminated when no longer needed.</p>
</section>
<section id="extensibility-and-limitations">
<h3>Extensibility and Limitations<a class="headerlink" href="#extensibility-and-limitations" title="Link to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p>The masking functions are extensible and can be adapted for new types of
features or grids.</p></li>
<li><p>The algorithms use the <code class="docutils literal notranslate"><span class="pre">shapely</span></code> library for geometric operations, which
is designed for 2D Cartesian geometry. Care is taken to handle longitude
periodicity, but there may be limitations near the poles or for very large
polygons.</p></li>
<li><p>For advanced use cases (e.g., custom mask types or additional properties),
see the source code and docstrings for guidance.</p></li>
</ul>
<p>See also the API documentation for <code class="xref py py-mod docutils literal notranslate"><span class="pre">mpas_tools.mesh.mask</span></code> for further details.</p>
<dl>
<dt>See also the API documentation for <code class="xref py py-mod docutils literal notranslate"><span class="pre">mpas_tools.mesh.mask</span></code> for further details.</dt><dd><blockquote>
<div><p>An MPAS mesh file</p>
</div></blockquote>
<dl class="option-list">
<dt><kbd><span class="option">-g <var>GEOJSON_FILE_NAME</var></span>, <span class="option">--geojson_file_name <var>GEOJSON_FILE_NAME</var></span></kbd></dt>
<dd><p>An Geojson file containing mask regions</p>
</dd>
<dt><kbd><span class="option">-o <var>MASK_FILE_NAME</var></span>, <span class="option">--mask_file_name <var>MASK_FILE_NAME</var></span></kbd></dt>
<dd><p>An output MPAS region masks file</p>
</dd>
</dl>
<dl class="simple">
<dt>-t MASK_TYPES [MASK_TYPES ‚Ä¶], ‚Äìmask_types MASK_TYPES [MASK_TYPES ‚Ä¶]</dt><dd><p>Which type(s) of masks to make: cell, edge or vertex.
Default is cell and vertex.</p>
</dd>
</dl>
<dl class="option-list">
<dt><kbd><span class="option">-c <var>CHUNK_SIZE</var></span>, <span class="option">--chunk_size <var>CHUNK_SIZE</var></span></kbd></dt>
<dd><p>The number of cells, vertices or edges that are
processed in one operation</p>
</dd>
<dt><kbd><span class="option">--show_progress</span></kbd></dt>
<dd><p>Whether to show a progress bar</p>
</dd>
<dt><kbd><span class="option">-s <var>SUBDIVISION</var></span>, <span class="option">--subdivision <var>SUBDIVISION</var></span></kbd></dt>
<dd><p>A threshold in degrees (lon or lat) above which the
mask region will be subdivided into smaller polygons
for faster intersection checking</p>
</dd>
<dt><kbd><span class="option">--process_count <var>PROCESS_COUNT</var></span></kbd></dt>
<dd><p>The number of processes to use to compute masks. The
default is to use all available cores</p>
</dd>
<dt><kbd><span class="option">--multiprocessing_method <var>MULTIPROCESSING_METHOD</var></span></kbd></dt>
<dd><p>The multiprocessing method use for python mask
creation (‚Äòfork‚Äô, ‚Äòspawn‚Äô or ‚Äòforkserver‚Äô)</p>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="computing-transect-masks">
<h3>Computing Transect Masks<a class="headerlink" href="#computing-transect-masks" title="Link to this heading">ÔÉÅ</a></h3>
<p>The function <a class="reference internal" href="generated/mpas_tools.mesh.mask.compute_mpas_transect_masks.html#mpas_tools.mesh.mask.compute_mpas_transect_masks" title="mpas_tools.mesh.mask.compute_mpas_transect_masks"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.mask.compute_mpas_transect_masks()</span></code></a>
and the <code class="docutils literal notranslate"><span class="pre">compute_mpas_transect_masks</span></code> command-line tool
are similar to the function for computing region masks.  The function takes a
<a class="reference external" href="http://mpas-dev.github.io/geometric_features/main/generated/geometric_features.FeatureCollection.html#geometric_features.FeatureCollection" title="(in geometric_features vmain)"><code class="xref py py-class docutils literal notranslate"><span class="pre">geometric_features.FeatureCollection</span></code></a> <code class="docutils literal notranslate"><span class="pre">fcMask</span></code> that is made up of
transects, rather than regions.  One mask is produced for each feature in the
collection, indicating where the transect
intersects the cell, edge or vertex polygons (see the
<a class="reference external" href="https://mpas-dev.github.io/files/documents/MPAS-MeshSpec.pdf">MPAS Mesh Specification</a>).</p>
<p>The arguments <code class="docutils literal notranslate"><span class="pre">logger</span></code>, <code class="docutils literal notranslate"><span class="pre">pool</span></code>, <code class="docutils literal notranslate"><span class="pre">chunkSize</span></code> and <code class="docutils literal notranslate"><span class="pre">showProgress</span></code> are the
same as for region-mask creation above.</p>
<p>The argument <code class="docutils literal notranslate"><span class="pre">subdivisionResolution</span></code> is a length in meters, above which
segments of the transect are subdivided to provide a better representation of
the spherical path in longitude/latitude space.  The default value of 10 km is
typically good enough to capture distortion at typical MPAS mesh resolutions.</p>
<p>The algorithm perform intersections in longitude/latitude space using the
<code class="docutils literal notranslate"><span class="pre">shapely</span></code> library.  Because <code class="docutils literal notranslate"><span class="pre">shapely</span></code> is designed for 2D shapes in a
Cartesian plane, it is not designed for spherical coordinates.  Care has been
taken to handle periodicity at the dateline (antimeridian) but there may be
issues with MPAS mesh polygons containing the north or south pole.  If a user
needs to handle a transect that is very close to the pole, it is likely worth
contacting the developers to request modifications to the code to support this
case.</p>
<p>The resulting variables are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">transectCellMasks(nCells,</span> <span class="pre">nTransects)</span></code> - a cell mask (1 if the transect
intersects the cell and 0 if not) for each transect</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transectEdgeMasks(nEdges,</span> <span class="pre">nTransects)</span></code> - an edge mask for each transect</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transectVertexMasks(nVertices,</span> <span class="pre">nTransects)</span></code> - a vertex mask for each
transect</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transectNames(nTransects,</span> <span class="pre">string64)</span></code> - the names of the transects</p></li>
</ul>
</div></blockquote>
<p>We don‚Äôt currently provide cell, edge or vertex indices (e.g.
<code class="docutils literal notranslate"><span class="pre">transectCellGlobalIDs</span></code>) for path along a transect.  This is, in part,
because the algorithm doesn‚Äôt keep track of the relative order of points along
a transect. This could be updated in the future if there is sufficient demand.</p>
<p>The edge sign (<code class="docutils literal notranslate"><span class="pre">transectEdgeMaskSigns</span></code>) is computed only if
<code class="docutils literal notranslate"><span class="pre">addEdgeSign=True</span></code>, since this takes extra time to compute and isn‚Äôt always
needed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the default <code class="docutils literal notranslate"><span class="pre">subdivisionResolution</span></code> is 10 km for
<a class="reference internal" href="generated/mpas_tools.mesh.mask.compute_mpas_transect_masks.html#mpas_tools.mesh.mask.compute_mpas_transect_masks" title="mpas_tools.mesh.mask.compute_mpas_transect_masks"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.mask.compute_mpas_transect_masks()</span></code></a>, the default
behavior in the command-line tool <code class="docutils literal notranslate"><span class="pre">compute_mpas_transect_masks</span></code> is no
subdivision because there is otherwise not a good way to specify at the
command line that no subdivision is desired.  Typically, users will want
to request subdivision with something like <code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">10e3</span></code></p>
</div>
<p>The command-line tool takes the following arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ compute_mpas_transect_masks --help
usage: compute_mpas_transect_masks [-h] -m MESH_FILE_NAME -g GEOJSON_FILE_NAME
                                   -o MASK_FILE_NAME
                                   [-t MASK_TYPES [MASK_TYPES ...]]
                                   [-c CHUNK_SIZE] [--show_progress]
                                   [-s SUBDIVISION]
                                   [--process_count PROCESS_COUNT]
                                   [--multiprocessing_method MULTIPROCESSING_METHOD]

optional arguments:
  -h, --help            show this help message and exit
  -m MESH_FILE_NAME, --mesh_file_name MESH_FILE_NAME
                        An MPAS mesh file
  -g GEOJSON_FILE_NAME, --geojson_file_name GEOJSON_FILE_NAME
                        An Geojson file containing transects
  -o MASK_FILE_NAME, --mask_file_name MASK_FILE_NAME
                        An output MPAS transect masks file
  -t MASK_TYPES [MASK_TYPES ...], --mask_types MASK_TYPES [MASK_TYPES ...]
                        Which type(s) of masks to make: cell, edge or vertex.
                        Default is cell, edge and vertex.
  -c CHUNK_SIZE, --chunk_size CHUNK_SIZE
                        The number of cells, vertices or edges that are
                        processed in one operation
  --show_progress       Whether to show a progress bar
  -s SUBDIVISION, --subdivision SUBDIVISION
                        The maximum resolution (in meters) of segments in a
                        transect. If a transect is too coarse, it will be
                        subdivided. Default is no subdivision.
  --process_count PROCESS_COUNT
                        The number of processes to use to compute masks. The
                        default is to use all available cores
  --multiprocessing_method MULTIPROCESSING_METHOD
                        The multiprocessing method use for python mask
                        creation (&#39;fork&#39;, &#39;spawn&#39; or &#39;forkserver&#39;)
  --add_edge_sign       Whether to add the transectEdgeMaskSigns variable
</pre></div>
</div>
</section>
<section id="computing-a-flood-fill-mask">
<h3>Computing a Flood-fill Mask<a class="headerlink" href="#computing-a-flood-fill-mask" title="Link to this heading">ÔÉÅ</a></h3>
<p>The function <a class="reference internal" href="generated/mpas_tools.mesh.mask.compute_mpas_flood_fill_mask.html#mpas_tools.mesh.mask.compute_mpas_flood_fill_mask" title="mpas_tools.mesh.mask.compute_mpas_flood_fill_mask"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.mask.compute_mpas_flood_fill_mask()</span></code></a>
and the command-line tool <code class="docutils literal notranslate"><span class="pre">compute_mpas_flood_fill_mask</span></code>
fill in a mask, starting with the cell centers closest to the seed points
given in <a class="reference external" href="http://mpas-dev.github.io/geometric_features/main/generated/geometric_features.FeatureCollection.html#geometric_features.FeatureCollection" title="(in geometric_features vmain)"><code class="xref py py-class docutils literal notranslate"><span class="pre">geometric_features.FeatureCollection</span></code></a> <code class="docutils literal notranslate"><span class="pre">fcSeed</span></code>.  This
algorithm runs in serial, and will be more efficient the more seed points
are provided and the more widely scattered over the mesh they are.</p>
<p>An optional <code class="docutils literal notranslate"><span class="pre">daGrow</span></code> argument to the function (not currently available from
the command-line tool) provides a mask into which the flood fill is allowed to
grow.  The default is all ones.</p>
<p>The resulting dataset contains a single variable:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cellSeedMask(nCells)</span></code> - a cell mask that is 1 where the flood fill
(following <code class="docutils literal notranslate"><span class="pre">cellsOnCell</span></code>) propagated starting from the seed points and 0
elsewhere</p></li>
</ul>
</div></blockquote>
<p>The command-line tool takes the following arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ compute_mpas_flood_fill_mask --help
usage: compute_mpas_flood_fill_mask [-h] -m MESH_FILE_NAME -g
                                    GEOJSON_FILE_NAME -o MASK_FILE_NAME

optional arguments:
  -h, --help            show this help message and exit
  -m MESH_FILE_NAME, --mesh_file_name MESH_FILE_NAME
                        An MPAS mesh file
  -g GEOJSON_FILE_NAME, --geojson_file_name GEOJSON_FILE_NAME
                        An Geojson file containing points at which to start
                        the flood fill
  -o MASK_FILE_NAME, --mask_file_name MASK_FILE_NAME
                        An output MPAS region masks file
</pre></div>
</div>
</section>
<section id="computing-lon-lat-region-masks">
<h3>Computing Lon/Lat Region Masks<a class="headerlink" href="#computing-lon-lat-region-masks" title="Link to this heading">ÔÉÅ</a></h3>
<p>The function <a class="reference internal" href="generated/mpas_tools.mesh.mask.compute_lon_lat_region_masks.html#mpas_tools.mesh.mask.compute_lon_lat_region_masks" title="mpas_tools.mesh.mask.compute_lon_lat_region_masks"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.mask.compute_lon_lat_region_masks()</span></code></a>
or the <code class="docutils literal notranslate"><span class="pre">compute_lon_lat_region_masks</span></code> command-line tool compute region masks
on a longitude/latitude grid but are otherwise functionally very similar to
the corresponding tools for compute MPAS region masks. The major difference is
that 1D arrays of longitude and latitude are provided instead of an MPAS mesh
dataset.  There is no argument equivalent to the mask type for MPAS meshes.
Instead, mask values are given at each point on the 2D longitude/latitude grid.
All other arguments serve the same purpose as for the MPAS region mask creation
described above.</p>
<p>The command-line tool takes the following arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ compute_lon_lat_region_masks --help
usage: compute_lon_lat_region_masks [-h] -i GRID_FILE_NAME [--lon LON]
                                    [--lat LAT] -g GEOJSON_FILE_NAME -o
                                    MASK_FILE_NAME [-c CHUNK_SIZE]
                                    [--show_progress] [-s SUBDIVISION]
                                    [--process_count PROCESS_COUNT]
                                    [--multiprocessing_method MULTIPROCESSING_METHOD]

optional arguments:
  -h, --help            show this help message and exit
  -i GRID_FILE_NAME, --grid_file_name GRID_FILE_NAME
                        An input lon/lat grid file
  --lon LON             The name of the longitude coordinate
  --lat LAT             The name of the latitude coordinate
  -g GEOJSON_FILE_NAME, --geojson_file_name GEOJSON_FILE_NAME
                        An Geojson file containing mask regions
  -o MASK_FILE_NAME, --mask_file_name MASK_FILE_NAME
                        An output MPAS region masks file
  -c CHUNK_SIZE, --chunk_size CHUNK_SIZE
                        The number of grid points that are processed in one
                        operation
  --show_progress       Whether to show a progress bar
  -s SUBDIVISION, --subdivision SUBDIVISION
                        A threshold in degrees (lon or lat) above which the
                        mask region will be subdivided into smaller polygons
                        for faster intersection checking
  --process_count PROCESS_COUNT
                        The number of processes to use to compute masks. The
                        default is to use all available cores
  --multiprocessing_method MULTIPROCESSING_METHOD
                        The multiprocessing method use for python mask
                        creation (&#39;fork&#39;, &#39;spawn&#39; or &#39;forkserver&#39;)
</pre></div>
</div>
</section>
</section>
<section id="culling-mpas-datasets">
<span id="cull-mpas-dataset"></span><h2>Culling MPAS Datasets<a class="headerlink" href="#culling-mpas-datasets" title="Link to this heading">ÔÉÅ</a></h2>
<p>The tools described in <a class="reference internal" href="#cell-culler"><span class="std std-ref">Cell Culler</span></a> can be used to create a culled
horizontal MPAS mesh.  Once a culled MPAS mesh has been created, an MPAS
dataset on the unculled mesh can be cropped to the culled mesh using the
the <a class="reference internal" href="generated/mpas_tools.mesh.cull.cull_dataset.html#mpas_tools.mesh.cull.cull_dataset" title="mpas_tools.mesh.cull.cull_dataset"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.cull.cull_dataset()</span></code></a> or
<a class="reference internal" href="generated/mpas_tools.mesh.cull.write_culled_dataset.html#mpas_tools.mesh.cull.write_culled_dataset" title="mpas_tools.mesh.cull.write_culled_dataset"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.cull.write_culled_dataset()</span></code></a> functions.  These
functions take a dataset (or filename) to crop as well as datasets (or
filenames) for the unculled and culled horizontal MPAS meshes.  They return
(or write out) the culled version of the data set.  Fields that exist in
the culled horizonal mesh are copied from the culled mesh, rather than cropped
from the dataset.  This because we wish to keep the cropped horizontal mesh
exactly as it was produced by the culling tool, which may not correspond to
a cropped version of the field from the original mesh.  For example, fields
are reindexed during culling and coordinates are recomputed.</p>
<p>It may be useful to compute and store the maps from cells, edges and vertices
on the culled mesh back to the unculled mesh for reuse.  This can be
accomplished by calling the <a class="reference internal" href="generated/mpas_tools.mesh.cull.map_culled_to_base.html#mpas_tools.mesh.cull.map_culled_to_base" title="mpas_tools.mesh.cull.map_culled_to_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.cull.map_culled_to_base()</span></code></a>
or <a class="reference internal" href="generated/mpas_tools.mesh.cull.write_map_culled_to_base.html#mpas_tools.mesh.cull.write_map_culled_to_base" title="mpas_tools.mesh.cull.write_map_culled_to_base"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.cull.write_map_culled_to_base()</span></code></a> functions.</p>
<p>An example workflow that culls out ice-shelf cavities from an MPAS-Ocean
initial condition might look like the following.  In this case the file
<code class="docutils literal notranslate"><span class="pre">culled_mesh.nc</span></code> is a mesh where land (and the grounded portion of the
ice sheet) has been removed but where ice-shelf cavities are still present.
It serves as the ‚Äúbase‚Äù mesh for the purposes of this example.
<code class="docutils literal notranslate"><span class="pre">culled_mesh_no_isc.nc</span></code> is created (if it doesn‚Äôt already exist) with the
ice-shelf cavities removed as well, so it is the ‚Äúculled‚Äù mesh in this example.
We store the mapping betwen the two horizontal meshes in
<code class="docutils literal notranslate"><span class="pre">no_isc_to_culled_map.nc</span></code> in case we want to resue it later.  The initial
condition is read from <code class="docutils literal notranslate"><span class="pre">initial_state.nc</span></code> and the culled version is written
to <code class="docutils literal notranslate"><span class="pre">initial_state_no_isc.nc</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_netcdf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.mesh.conversion</span><span class="w"> </span><span class="kn">import</span> <span class="n">cull</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.mesh.cull</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_map_culled_to_base</span><span class="p">,</span> <span class="n">write_culled_dataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">LoggingContext</span>


<span class="n">in_filename</span> <span class="o">=</span> <span class="s1">&#39;initial_state.nc&#39;</span>
<span class="n">out_filename</span> <span class="o">=</span> <span class="s1">&#39;initial_state_no_isc.nc&#39;</span>
<span class="n">base_mesh_filename</span> <span class="o">=</span> <span class="s1">&#39;culled_mesh.nc&#39;</span>
<span class="n">culled_mesh_filename</span> <span class="o">=</span> <span class="s1">&#39;culled_mesh_no_isc.nc&#39;</span>
<span class="n">map_filename</span> <span class="o">=</span> <span class="s1">&#39;no_isc_to_culled_map.nc&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">culled_mesh_filename</span><span class="p">):</span>
    <span class="n">ds_culled_mesh</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">base_mesh_filename</span><span class="p">)</span>
    <span class="n">ds_init</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">in_filename</span><span class="p">)</span>
    <span class="n">ds_culled_mesh</span><span class="p">[</span><span class="s1">&#39;cullCell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_init</span><span class="o">.</span><span class="n">landIceMask</span>
    <span class="n">ds_culled_mesh_no_isc</span> <span class="o">=</span> <span class="n">cull</span><span class="p">(</span><span class="n">ds_culled_mesh</span><span class="p">)</span>
    <span class="n">write_netcdf</span><span class="p">(</span><span class="n">ds_culled_mesh_no_isc</span><span class="p">,</span> <span class="n">culled_mesh_filename</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">map_filename</span><span class="p">):</span>
    <span class="n">write_map_culled_to_base</span><span class="p">(</span><span class="n">base_mesh_filename</span><span class="o">=</span><span class="n">base_mesh_filename</span><span class="p">,</span>
                             <span class="n">culled_mesh_filename</span><span class="o">=</span><span class="n">culled_mesh_filename</span><span class="p">,</span>
                             <span class="n">out_filename</span><span class="o">=</span><span class="n">map_filename</span><span class="p">)</span>

<span class="k">with</span> <span class="n">LoggingContext</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
    <span class="n">write_culled_dataset</span><span class="p">(</span><span class="n">in_filename</span><span class="o">=</span><span class="n">in_filename</span><span class="p">,</span> <span class="n">out_filename</span><span class="o">=</span><span class="n">out_filename</span><span class="p">,</span>
                         <span class="n">base_mesh_filename</span><span class="o">=</span><span class="n">base_mesh_filename</span><span class="p">,</span>
                         <span class="n">culled_mesh_filename</span><span class="o">=</span><span class="n">culled_mesh_filename</span><span class="p">,</span>
                         <span class="n">map_culled_to_base_filename</span><span class="o">=</span><span class="n">map_filename</span><span class="p">,</span>
                         <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="merging-and-splitting">
<span id="merge-split"></span><h2>Merging and Splitting<a class="headerlink" href="#merging-and-splitting" title="Link to this heading">ÔÉÅ</a></h2>
<p>In order to support running
<a class="reference external" href="https://github.com/MPAS-Dev/MPAS-Model/tree/landice/develop">MPAS-Albany Land Ice (MALI)</a>
with both Greenland and Antarctica at the same time, tools have been added to
support merging and splitting MPAS meshes.</p>
<p>Merging two meshes can be accomplished with
<a class="reference internal" href="generated/mpas_tools.merge_grids.merge_grids.html#mpas_tools.merge_grids.merge_grids" title="mpas_tools.merge_grids.merge_grids"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.merge_grids.merge_grids()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.translate</span><span class="w"> </span><span class="kn">import</span> <span class="n">translate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.merge_grids</span><span class="w"> </span><span class="kn">import</span> <span class="n">merge_grids</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.planar_hex</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_planar_hex_mesh</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_netcdf</span>


<span class="n">dsMesh1</span> <span class="o">=</span> <span class="n">make_planar_hex_mesh</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">nonperiodic_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">nonperiodic_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dsMesh2</span> <span class="o">=</span> <span class="n">make_planar_hex_mesh</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">nonperiodic_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">nonperiodic_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">translate</span><span class="p">(</span><span class="n">dsMesh2</span><span class="p">,</span> <span class="n">xOffset</span><span class="o">=</span><span class="mf">20000.</span><span class="p">,</span> <span class="n">yOffset</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

<span class="n">write_netcdf</span><span class="p">(</span><span class="n">dsMesh1</span><span class="p">,</span> <span class="s1">&#39;mesh1.nc&#39;</span><span class="p">)</span>
<span class="n">write_netcdf</span><span class="p">(</span><span class="n">dsMesh2</span><span class="p">,</span> <span class="s1">&#39;mesh2.nc&#39;</span><span class="p">)</span>

<span class="n">merge_grids</span><span class="p">(</span><span class="n">infile1</span><span class="o">=</span><span class="s1">&#39;mesh1.nc&#39;</span><span class="p">,</span> <span class="n">infile2</span><span class="o">=</span><span class="s1">&#39;mesh2.nc&#39;</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;merged_mesh.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Typically, it will only make sense to merge non-periodic meshes in this way.</p>
<p>Later, perhaps during analysis or visualization, it can be useful to split
apart the merged meshes.  This can be done with
<a class="reference internal" href="generated/mpas_tools.split_grids.split_grids.html#mpas_tools.split_grids.split_grids" title="mpas_tools.split_grids.split_grids"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.split_grids.split_grids()</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.translate</span><span class="w"> </span><span class="kn">import</span> <span class="n">translate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.split_grids</span><span class="w"> </span><span class="kn">import</span> <span class="n">split_grids</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.planar_hex</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_planar_hex_mesh</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_netcdf</span>


<span class="n">dsMesh1</span> <span class="o">=</span> <span class="n">make_planar_hex_mesh</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">nonperiodic_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">nonperiodic_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dsMesh2</span> <span class="o">=</span> <span class="n">make_planar_hex_mesh</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">nonperiodic_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">nonperiodic_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">translate</span><span class="p">(</span><span class="n">dsMesh2</span><span class="p">,</span> <span class="n">xOffset</span><span class="o">=</span><span class="mf">20000.</span><span class="p">,</span> <span class="n">yOffset</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

<span class="n">write_netcdf</span><span class="p">(</span><span class="n">dsMesh1</span><span class="p">,</span> <span class="s1">&#39;mesh1.nc&#39;</span><span class="p">)</span>
<span class="n">write_netcdf</span><span class="p">(</span><span class="n">dsMesh2</span><span class="p">,</span> <span class="s1">&#39;mesh2.nc&#39;</span><span class="p">)</span>


<span class="n">split_grids</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s1">&#39;merged_mesh.nc&#39;</span><span class="p">,</span> <span class="n">outfile1</span><span class="o">=</span><span class="s1">&#39;split_mesh1.nc&#39;</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;split_mesh2.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Merging meshes can also be accomplished with the <code class="docutils literal notranslate"><span class="pre">merge_grids</span></code> command-line
tool:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ merge_grids --help

usage: merge_grids [-h] [-o FILENAME] FILENAME1 FILENAME2

Tool to merge 2 MPAS non-contiguous meshes together into a single file

positional arguments:
  FILENAME1    File name for first mesh to merge
  FILENAME2    File name for second mesh to merge

optional arguments:
  -h, --help   show this help message and exit
  -o FILENAME  The merged mesh file
</pre></div>
</div>
<p>Similarly, <code class="docutils literal notranslate"><span class="pre">split_grids</span></code> can be used to to split meshes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ split_grids --help

usage: split_grids [-h] [-1 FILENAME] [-2 FILENAME] [--nCells NCELLS]
                   [--nEdges NEDGES] [--nVertices NVERTICES]
                   [--maxEdges MAXEDGES1 MAXEDGES2]
                   MESHFILE

Tool to split 2 previously merged MPAS non-contiguous meshes into separate files.
Typical usage is:
    split_grids.py -1 outfile1.nc -2 outfile2.nc infile
The optional arguments for nCells, nEdges, nVertices, and maxEdges should
generally not be required as this information is saved in the combined mesh file
as global attributes by the merge_grids.py script.

positional arguments:
  MESHFILE              Mesh file to split

optional arguments:
  -h, --help            show this help message and exit
  -1 FILENAME, --outfile1 FILENAME
                        File name for first mesh output
                        (default: mesh1.nc)
  -2 FILENAME, --outfile2 FILENAME
                        File name for second mesh output
                        (default: mesh2.nc)
  --nCells NCELLS       The number of cells in the first mesh
                        (default: the value specified in MESHFILE global attribute merge_point)
  --nEdges NEDGES       The number of edges in the first mesh
                        (default: the value specified in MESHFILE global attribute merge_point)
  --nVertices NVERTICES
                        The number of vertices in the first mesh
                        (default: the value specified in MESHFILE global attribute merge_point)
  --maxEdges MAXEDGES1 MAXEDGES2
                        The number of maxEdges in each mesh
                        (default: the value specified in MESHFILE global attribute merge_point
                              OR: will use MESHFILE maxEdges dimension and assume same for both)
</pre></div>
</div>
</section>
<section id="translation">
<span id="mesh-translation"></span><h2>Translation<a class="headerlink" href="#translation" title="Link to this heading">ÔÉÅ</a></h2>
<p>A planar mesh can be translated in x, y or both by calling
<a class="reference internal" href="generated/mpas_tools.translate.translate.html#mpas_tools.translate.translate" title="mpas_tools.translate.translate"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.translate.translate()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.translate</span><span class="w"> </span><span class="kn">import</span> <span class="n">translate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.planar_hex</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_planar_hex_mesh</span>

<span class="n">dsMesh</span> <span class="o">=</span> <span class="n">make_planar_hex_mesh</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">nonperiodic_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">nonperiodic_y</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">translate</span><span class="p">(</span><span class="n">dsMesh</span><span class="p">,</span> <span class="n">xOffset</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">yOffset</span><span class="o">=</span><span class="mf">2000.</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates a periodic, planar mesh and then translates it by 1 km in x and
2 km in y.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the functions in the <code class="docutils literal notranslate"><span class="pre">mpas_tools.translate</span></code> module modify the mesh
inplace, rather than returning a new <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code> object.  This is
in contrast to typical <code class="docutils literal notranslate"><span class="pre">xarray</span></code> functions and methods.</p>
</div>
<p>A mesh can be translated so that its center is at <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">0.</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">0.</span></code> with
the function <a class="reference internal" href="generated/mpas_tools.translate.center.html#mpas_tools.translate.center" title="mpas_tools.translate.center"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.translate.center()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.translate</span><span class="w"> </span><span class="kn">import</span> <span class="n">center</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.planar_hex</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_planar_hex_mesh</span>

<span class="n">dsMesh</span> <span class="o">=</span> <span class="n">make_planar_hex_mesh</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">nonperiodic_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">nonperiodic_y</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">center</span><span class="p">(</span><span class="n">dsMesh</span><span class="p">)</span>
</pre></div>
</div>
<p>A mesh can be translated so its center matches the center of another mesh by
using <a class="reference internal" href="generated/mpas_tools.translate.center_on_mesh.html#mpas_tools.translate.center_on_mesh" title="mpas_tools.translate.center_on_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.translate.center_on_mesh()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.translate</span><span class="w"> </span><span class="kn">import</span> <span class="n">center_on_mesh</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpas_tools.planar_hex</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_planar_hex_mesh</span>

<span class="n">dsMesh1</span> <span class="o">=</span> <span class="n">make_planar_hex_mesh</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">nonperiodic_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">nonperiodic_y</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">dsMesh2</span> <span class="o">=</span> <span class="n">make_planar_hex_mesh</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="mf">2000.</span><span class="p">,</span> <span class="n">nonperiodic_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">nonperiodic_y</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">center_on_mesh</span><span class="p">(</span><span class="n">dsMesh2</span><span class="p">,</span> <span class="n">dsMesh1</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, the coordinates of <code class="docutils literal notranslate"><span class="pre">dsMesh2</span></code> are altered so its center
matches that of <code class="docutils literal notranslate"><span class="pre">dsMesh1</span></code>.</p>
<p>The functionality of all three of these functions is also available via the
<code class="docutils literal notranslate"><span class="pre">translate_planar_grid</span></code> command-line tool:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ translate_planar_grid --help

== Gathering information.  (Invoke with --help for more details. All arguments are optional)
Usage: translate_planar_grid [options]

This script translates the coordinate system of the planar MPAS mesh specified
with the -f flag.  There are 3 possible methods to choose from: 1) shift the
origin to the center of the domain 2) arbirary shift in x and/or y 3) shift to
the center of the domain described in a separate file

Options:
  -h, --help            show this help message and exit
  -f FILENAME, --file=FILENAME
                        MPAS planar grid file name. [default: grid.nc]
  -d FILENAME, --datafile=FILENAME
                        data file name to which to match the domain center of.
                        Uses xCell,yCell or, if those fields do not exist,
                        will secondly try x1,y1 fields.
  -x SHIFT_VALUE        user-specified shift in the x-direction. [default:
                        0.0]
  -y SHIFT_VALUE        user-specified shift in the y-direction. [default:
                        0.0]
  -c                    shift so origin is at center of domain [default:
                        False]
</pre></div>
</div>
</section>
<section id="converting-between-mesh-formats">
<h2>Converting Between Mesh Formats<a class="headerlink" href="#converting-between-mesh-formats" title="Link to this heading">ÔÉÅ</a></h2>
<section id="msh-to-mpas-netcdf">
<h3>MSH to MPAS NetCDF<a class="headerlink" href="#msh-to-mpas-netcdf" title="Link to this heading">ÔÉÅ</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">jigsawpy</span></code> produces meshes in <code class="docutils literal notranslate"><span class="pre">.msh</span></code> format that need to be converted to
<a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/">NetCDF</a> files for use by MPAS
components.  A utility function
<a class="reference internal" href="generated/mpas_tools.mesh.creation.jigsaw_to_netcdf.jigsaw_to_netcdf.html#mpas_tools.mesh.creation.jigsaw_to_netcdf.jigsaw_to_netcdf" title="mpas_tools.mesh.creation.jigsaw_to_netcdf.jigsaw_to_netcdf"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.creation.jigsaw_to_netcdf.jigsaw_to_netcdf()</span></code></a> or the
command-line utility <code class="docutils literal notranslate"><span class="pre">jigsaw_to_netcdf</span></code> are used for this purpose.</p>
<p>In addition to the input <code class="docutils literal notranslate"><span class="pre">.msh</span></code> and output <code class="docutils literal notranslate"><span class="pre">.nc</span></code> files, the user must
specify whether this is a spherical or planar mesh and, if it is spherical,
provide the radius of the Earth in meters.</p>
</section>
<section id="triangle-to-mpas-netcdf">
<h3>Triangle to MPAS NetCDF<a class="headerlink" href="#triangle-to-mpas-netcdf" title="Link to this heading">ÔÉÅ</a></h3>
<p>Meshes in <a class="reference external" href="https://www.cs.cmu.edu/~quake/triangle.html">Triangle</a> format
can be converted to MPAS NetCDF format using
<a class="reference internal" href="generated/mpas_tools.mesh.creation.triangle_to_netcdf.triangle_to_netcdf.html#mpas_tools.mesh.creation.triangle_to_netcdf.triangle_to_netcdf" title="mpas_tools.mesh.creation.triangle_to_netcdf.triangle_to_netcdf"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.creation.triangle_to_netcdf.triangle_to_netcdf()</span></code></a> or
the <code class="docutils literal notranslate"><span class="pre">triangle_to_netcdf</span></code> command-line tool.</p>
<p>The user supplies the names of input <code class="docutils literal notranslate"><span class="pre">.node</span></code> and <code class="docutils literal notranslate"><span class="pre">.ele</span></code> files and the
name of an output MPAS mesh file.</p>
</section>
<section id="mpas-netcdf-to-triangle">
<h3>MPAS NetCDF to Triangle<a class="headerlink" href="#mpas-netcdf-to-triangle" title="Link to this heading">ÔÉÅ</a></h3>
<p>MPAS meshes in NetCDF format can be converted to <code class="docutils literal notranslate"><span class="pre">Triangle</span></code> format using
<a class="reference internal" href="generated/mpas_tools.mesh.creation.mpas_to_triangle.mpas_to_triangle.html#mpas_tools.mesh.creation.mpas_to_triangle.mpas_to_triangle" title="mpas_tools.mesh.creation.mpas_to_triangle.mpas_to_triangle"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.creation.mpas_to_triangle.mpas_to_triangle()</span></code></a> or
the <code class="docutils literal notranslate"><span class="pre">mpas_to_triangle</span></code> command-line tool.</p>
<p>The user supplies the name of an input MPAS mesh file and the output prefix
for the resulting Triangle <code class="docutils literal notranslate"><span class="pre">.node</span></code> and <code class="docutils literal notranslate"><span class="pre">.ele</span></code> files.</p>
</section>
<section id="mpas-netcdf-to-scrip">
<h3>MPAS NetCDF to SCRIP<a class="headerlink" href="#mpas-netcdf-to-scrip" title="Link to this heading">ÔÉÅ</a></h3>
<p>The function <a class="reference internal" href="generated/mpas_tools.scrip.from_mpas.scrip_from_mpas.html#mpas_tools.scrip.from_mpas.scrip_from_mpas" title="mpas_tools.scrip.from_mpas.scrip_from_mpas"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.scrip.from_mpas.scrip_from_mpas()</span></code></a> can be
used to convert an MPAS mesh file in NetCDF format to
<a class="reference external" href="http://www.earthsystemmodeling.org/esmf_releases/public/ESMF_5_2_0rp1/ESMF_refdoc/node3.html#SECTION03024000000000000000">SCRIP</a>
format.  SCRIP files are typically used to create mapping files used to
interpolate between meshes.</p>
<p>A command-line tools is also available for this purpose:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ scrip_from_mpas --help
== Gathering information.  (Invoke with --help for more details. All arguments are optional)
Usage: scrip_from_mpas [options]

This script takes an MPAS grid file and generates a SCRIP grid file.

Options:
  -h, --help            show this help message and exit
  -m FILENAME, --mpas=FILENAME
                        MPAS grid file name used as input. [default: grid.nc]
  -s FILENAME, --scrip=FILENAME
                        SCRIP grid file to output. [default: scrip.nc]
  -l, --landice         If flag is on, landice masks will be computed and
                        used.
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mesh_creation.html" class="btn btn-neutral float-left" title="Mesh Creation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="interpolation.html" class="btn btn-neutral float-right" title="Interpolation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright This software is open source software available under the BSD-3license. Copyright (c) 2025 Triad National Security, LLC. All rights reserved. Copyright (c) 2025 Lawrence Livermore National Security, LLC. All rights reserved. Copyright (c) 2025 UT-Battelle, LLC. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   

  <!-- Meta tags for JS to use -->
  <meta name="doc-version" content="master">
  <meta name="doc-site-root" content="./">

  <!-- Create version switcher container -->
  <script>
    const sidebar = document.querySelector('.wy-side-nav-search');
    if (sidebar) {
      const versionDiv = document.createElement('div');
      versionDiv.id = 'version-switcher';
      versionDiv.style.marginTop = '1em';
      sidebar.appendChild(versionDiv);
    }
  </script>

  <!-- Load version-switcher.js using the correct relative path -->
  <script src="../shared/version-switcher.js"></script>


</body>
</html>